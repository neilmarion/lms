require "rails_helper"

module Lms
  describe AmortizationLogic do
    let(:daily_interest_map) {
      {
       "2020-03-01":0.0003125,
       "2020-03-02":0.0003125,
       "2020-03-03":0.0003125,
       "2020-03-04":0.0003125,
       "2020-03-05":0.0003125,
       "2020-03-06":0.0003125,
       "2020-03-07":0.0003125,
       "2020-03-08":0.0003125,
       "2020-03-09":0.0003125,
       "2020-03-10":0.0003125,
       "2020-03-11":0.0003125,
       "2020-03-12":0.0003125,
       "2020-03-13":0.0003125,
       "2020-03-14":0.0003125,
       "2020-03-15":0.0003125,
       "2020-03-16":0.0003125,
       "2020-03-17":0.0003125,
       "2020-03-18":0.0003125,
       "2020-03-19":0.0003125,
       "2020-03-20":0.0003125,
       "2020-03-21":0.0003125,
       "2020-03-22":0.0003125,
       "2020-03-23":0.0003125,
       "2020-03-24":0.0003125,
       "2020-03-25":0.0003125,
       "2020-03-26":0.0003125,
       "2020-03-27":0.0003125,
       "2020-03-28":0.0003125,
       "2020-03-29":0.0003125,
       "2020-03-30":0.0003125,
       "2020-03-31":0.0003125,
       "2020-04-01":0.0003125,
       "2020-04-02":0.0003333333333333333,
       "2020-04-03":0.0003333333333333333,
       "2020-04-04":0.0003333333333333333,
       "2020-04-05":0.0003333333333333333,
       "2020-04-06":0.0003333333333333333,
       "2020-04-07":0.0003333333333333333,
       "2020-04-08":0.0003333333333333333,
       "2020-04-09":0.0003333333333333333,
       "2020-04-10":0.0003333333333333333,
       "2020-04-11":0.0003333333333333333,
       "2020-04-12":0.0003333333333333333,
       "2020-04-13":0.0003333333333333333,
       "2020-04-14":0.0003333333333333333,
       "2020-04-15":0.0003333333333333333,
       "2020-04-16":0.0003333333333333333,
       "2020-04-17":0.0003333333333333333,
       "2020-04-18":0.0003333333333333333,
       "2020-04-19":0.0003333333333333333,
       "2020-04-20":0.0003333333333333333,
       "2020-04-21":0.0003333333333333333,
       "2020-04-22":0.0003333333333333333,
       "2020-04-23":0.0003333333333333333,
       "2020-04-24":0.0003333333333333333,
       "2020-04-25":0.0003333333333333333,
       "2020-04-26":0.0003333333333333333,
       "2020-04-27":0.0003333333333333333,
       "2020-04-28":0.0003333333333333333,
       "2020-04-29":0.0003333333333333333,
       "2020-04-30":0.0003333333333333333,
       "2020-05-01":0.0003333333333333333,
       "2020-05-02":0.0003333333333333333
      }
    }

    let(:expected_result) {
      {
        aaa_bal: 100968.75,
        aaa_pri: 100000.0,
        day_int: 31.25,
        tot_int: 1000.0,
        tot_chg: 0,
        int_chg: 0,
        pri_chg: 0,
        zzz_int: 1000.0,
        zzz_pri: 100000.0,
        zzz_bal: 101000.0,
      }
    }

    let(:selected_date) { "2020-04-01" }

    it "returns payment per period" do
      logic = described_class.new(100000, daily_interest_map, [])
      result = logic.execute
      expect(result[selected_date]).to eq expected_result[selected_date]
    end
  end
end
